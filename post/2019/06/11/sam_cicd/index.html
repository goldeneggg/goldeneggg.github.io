<!DOCTYPE html>
<html lang="">
<head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<meta name="description" content="This is my portfolio. I&#39;m Web Developer, Software Engineer, Engineering Manager and Backpacker. Ruby/Rails/Go/PHP/Java/Linux/MySQL/Docker/AWS/Fintech/Payment">
<meta name="keywords" content="developer,software engineer,technology,web,blog,freelance,hugo">

<base href="https://horizoon.jp">

<title>
  horizoon - Travis CIã«ã‚ˆã‚‹Lambdaã®è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ with AWS SAM in Go 
</title>

<meta name="generator" content="Hugo 0.62.0" />



<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,400|Roboto+Slab:400,700|Roboto:300,300i,400,400i,500,500i,700,700i">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
<link rel="stylesheet" href="https://horizoon.jp/css/main.css">
<link rel="stylesheet" href="https://horizoon.jp/css/custom.css">




<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="theme-color" content="#ffffff">

</head>
<body lang="">
<div class="container">


<header class="row text-left title">
  <h1 class="title">Travis CIã«ã‚ˆã‚‹Lambdaã®è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ with AWS SAM in Go</h1>
</header>
<section id="category-pane" class="row meta">
  
  <div class="col-md-12">
    <h6 class="text-left meta">
        PUBLISHED ON 2019-06-11 
      
      
      
      â€”
      
      
      <a class="meta" href="/categories/aws">AWS</a>, 
      
      <a class="meta" href="/categories/aws-sam">AWS SAM</a>, 
      
      <a class="meta" href="/categories/go">GO</a>, 
      
      <a class="meta" href="/categories/golang">GOLANG</a>, 
      
      <a class="meta" href="/categories/lambda">LAMBDA</a>, 
      
      <a class="meta" href="/categories/travis-ci">TRAVIS CI</a>
      
      
      
    </h6>
  </div>
  
</section>
<section id="content-pane" class="row">
  <div class="col-md-12 text-justify content">
    
    <h1 id="summary">Summary</h1>
<ul>
<li>AWS SAMã§ç®¡ç†ã—ã¦ã„ã‚‹Lambda Functionã®ãƒ‡ãƒ—ãƒ­ã‚¤è‡ªå‹•åŒ–ã‚’ã€<strong>AWS CodePipelineã‚„AWS CodeBuildã‚’ä½¿ã†ã“ã¨ãªã</strong> Travis CIã‚’æ´»ç”¨ã—ã¦è¡Œã†
<ul>
<li>ä»Šå›åˆ©ç”¨ã—ãŸLambda Functionã¯Goè£½</li>
<li>Pull Requestã®masterãƒ–ãƒ©ãƒ³ãƒã¸ã®mergeæ™‚ã«ã€samã‚³ãƒãƒ³ãƒ‰ã§è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤</li>
</ul>
</li>
</ul>
<h1 id="heading">å‰ææ¡ä»¶</h1>
<ul>
<li>Lambdaã®ãƒªãƒã‚¸ãƒˆãƒªã¯github</li>
<li>å„ç¨®ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ã¯ä¸‹è¨˜ã®é€šã‚Š</li>
</ul>
<pre><code>$ python --version
Python 2.7.12

$ pip --version
pip 19.0.3 from /usr/local/lib/python2.7/dist-packages/pip (python 2.7)

$ aws --version
aws-cli/1.16.175 Python/2.7.12 Linux/4.15.0-1028-gcp botocore/1.12.165

$ sam --version
SAM CLI, version 0.17.0
</code></pre><h1 id="samlambdatravis-ci">SAMã§ç®¡ç†ã—ã¦ã„ã‚‹Lambdaã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’Travis CIã§è‡ªå‹•åŒ–ã—ãŸã„</h1>
<p>SAMã§ç®¡ç†ã—ã¦ã„ã‚‹Lambdaã®ãƒ‡ãƒ—ãƒ­ã‚¤è‡ªå‹•åŒ–ã‚’Travis CIã§è¡Œã„ã¾ã™ã€‚SAMã§ç®¡ç†ã—ã¦ã„ã‚‹ã‹ã‚‰ã«ã¯SAMã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨aws-sam-cliã‚’ä½¿ã£ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è¡Œã„ãŸã„ã§ã™ã€‚ãªã®ã§<a href="https://docs.travis-ci.com/user/deployment/lambda/">Traviså…¬å¼ã®Lambdaãƒ‡ãƒ—ãƒ­ã‚¤ã‚µãƒãƒ¼ãƒˆ</a>ã¯ä½¿ç”¨ã—ã¾ã›ã‚“ã€‚</p>
<ul>
<li>branch != master ã®å ´åˆã®CI
<ol>
<li>Lambdaã‚³ãƒ¼ãƒ‰ã®ãƒ†ã‚¹ãƒˆ</li>
<li>Lambdaã‚³ãƒ¼ãƒ‰ã®lintï¼ˆgolintã‚„go vetãªã©ï¼‰</li>
<li><code>sam validate</code></li>
</ol>
</li>
<li>branch == master ã®å ´åˆã®CI, ãƒ‡ãƒ—ãƒ­ã‚¤
<ol>
<li>CIæ™‚ã«å®Ÿæ–½ã—ãŸäº‹å…¨ã¦</li>
<li><code>sam package</code></li>
<li><code>sam deploy</code></li>
</ol>
</li>
</ul>
<p>ã“ã‚Œã‚‰ã‚’.travis.ymlã§å®šç¾©ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è‡ªå‹•åŒ–ã—ã¾ã™ã€‚</p>
<h2 id="heading-1">ã‚»ã‚­ãƒ¥ã‚¢ãªç’°å¢ƒå¤‰æ•°ã®è¨­å®š</h2>
<p>Travis CIã§samã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ãŸã„å ´åˆã«å¿…è¦ãªç’°å¢ƒå¤‰æ•°ã¯ä¸‹è¨˜ã®3ã¤ã§ã™ã€‚</p>
<ul>
<li>AWS_ACCESS_KEY_ID</li>
<li>AWS_SECRET_ACCESS_KEY</li>
<li>AWS_DEFAULT_REGION</li>
</ul>
<p>ã‚»ã‚­ãƒ¥ã‚¢ãªå¤‰æ•°ã¯ <a href="https://docs.travis-ci.com/user/environment-variables/#defining-encrypted-variables-in-travisyml"><code>travis encrypt</code> ã‚³ãƒãƒ³ãƒ‰ã§æš—å·åŒ–ã—ã¦.travis.yml ã«è¨­å®šã—ã¾ã™</a>ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ travis encrypt <span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span>YOUR_KEY_ID

Please add the following to your .travis.yml file:

  secure: <span class="s2">&#34;XXX&#34;</span>  <span class="c1"># ã“ã®å†…å®¹ã‚’.travis.ymlã«è¨­å®šã™ã‚‹</span>

$ travis encrypt <span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span>YOUR_KEY

Please add the following to your .travis.yml file:

  secure: <span class="s2">&#34;XXX&#34;</span>  <span class="c1"># ã“ã®å†…å®¹ã‚’.travis.ymlã«è¨­å®šã™ã‚‹</span>
</code></pre></div><h2 id="travisyml">.travis.yml</h2>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml">dist<span class="p">:</span><span class="w"> </span>xenial<span class="w">
</span><span class="w">
</span><span class="w"></span>go<span class="p">:</span><span class="w">
</span><span class="w">  </span>-<span class="w"> </span><span class="m">1.12</span>.x<span class="w">
</span><span class="w">
</span><span class="w"></span>sudo<span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="w">
</span><span class="w"></span>env<span class="p">:</span><span class="w">
</span><span class="w">  </span>matrix<span class="p">:</span><span class="w">
</span><span class="w">    </span>-<span class="w"> </span>GO111MODULE=on<span class="w">
</span><span class="w">  </span>global<span class="p">:</span><span class="w">
</span><span class="w">    </span>-<span class="w"> </span>AWS_DEFAULT_REGION=ap-northeast<span class="m">-1</span><span class="w">
</span><span class="w">    </span>-<span class="w"> </span>secure<span class="p">:</span><span class="w"> </span>ENCRYPTED_ACCESS_KEY_ID<span class="w">
</span><span class="w">    </span>-<span class="w"> </span>secure<span class="p">:</span><span class="w"> </span>ENCRYPTED_SECRET_ACCESS_KEY<span class="w">
</span><span class="w">
</span><span class="w"></span>install<span class="p">:</span><span class="w">
</span><span class="w">  </span>-<span class="w"> </span>go<span class="w"> </span>mod<span class="w"> </span>download<span class="w">
</span><span class="w">  </span>-<span class="w"> </span>python<span class="w"> </span>--version<span class="w">
</span><span class="w">  </span>-<span class="w"> </span>pip<span class="w"> </span>--version<span class="w">
</span><span class="w">  </span>-<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>--user<span class="w"> </span>awscli<span class="w">
</span><span class="w">  </span>-<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>--user<span class="w"> </span>aws-sam-cli<span class="w">
</span><span class="w">
</span><span class="w"></span>script<span class="p">:</span><span class="w">
</span><span class="w">  </span>-<span class="w"> </span>go<span class="w"> </span>test<span class="w"> </span>./...<span class="w">
</span><span class="w">  </span>-<span class="w"> </span>sam<span class="w"> </span>validate<span class="w">
</span><span class="w">
</span><span class="w"></span>deploy<span class="p">:</span><span class="w">
</span><span class="w">  </span>provider<span class="p">:</span><span class="w"> </span>script<span class="w">
</span><span class="w">  </span>script<span class="p">:</span><span class="w"> </span><span class="s2">&#34;./deploy.sh&#34;</span><span class="w">
</span><span class="w">  </span>skip_cleanup<span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">  </span>on<span class="p">:</span><span class="w">
</span><span class="w">    </span>branch<span class="p">:</span><span class="w"> </span>master<span class="w">
</span><span class="w">
</span><span class="w"></span>notifications<span class="p">:</span><span class="w">
</span><span class="w">  </span>email<span class="p">:</span><span class="w">
</span><span class="w">    </span>on_success<span class="p">:</span><span class="w"> </span>never<span class="w">
</span></code></pre></div><p>pythonã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå¤ã„ã¨<code>sam</code>ã‚³ãƒãƒ³ãƒ‰ãŒã‚³ã‚±ã‚‹ã®ã§<a href="https://docs.travis-ci.com/user/reference/xenial/#python-support"><code>dist: xenial</code>ã§Xenialãƒ™ãƒ¼ã‚¹ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æŒ‡å®šã—ã€æ¥µåŠ›æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®pythonã‚’åˆ©ç”¨</a>ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚</p>
<p><code>language: go</code>ãªãƒ“ãƒ«ãƒ‰ã‚¤ãƒ¡ãƒ¼ã‚¸ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹pythonã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ã€<code>dist: xenial</code>ã‚’æŒ‡å®šã—ãªã„ï¼<code>dist: trusty</code>ãŒé¸æŠã•ã‚Œã‚Œã°ï¼ˆã“ã®è¨˜äº‹ã®åŸ·ç­†æ™‚ç‚¹ã§ã¯ï¼‰2.7.6ã«ãªã‚Šã¾ã™ã€‚ä¾‹ãˆã°<code>sam validate</code>ã‚’ver 2.7.6ãªpythonç’°å¢ƒã§å®Ÿè¡Œã™ã‚‹ã¨ã€SNIMissingWarningãŒç™ºç”Ÿã—ã¦ã—ã¾ã„ã¾ã™ã€‚</p>
<pre><code>/home/travis/.local/lib/python2.7/site-packages/urllib3/util/ssl_.py:365: SNIMissingWarning: An HTTPS request has been made, but the SNI (Server Name Indication) extension to TLS is not available on this platform.
This may cause the server to present an incorrect TLS certificate, which can cause validation failures.
You can upgrade to a newer version of Python to solve this. For more information, see https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings
  SNIMissingWarning
</code></pre><p>deployã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®scriptã§<code>go build</code> =&gt; <code>sam package</code> =&gt; <code>sam deploy</code>ã‚’å®Ÿè¡Œã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç”¨æ„ãƒ»æŒ‡å®šã—ã¾ã™ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="cp">#!/bin/bash
</span><span class="cp"></span>
<span class="c1"># ./deploy.sh</span>

<span class="nb">set</span> -eu

<span class="c1"># template.yamlã®Resourcesã®é–¢æ•°å®šç¾©ã®å†…å®¹ã¨åˆã‚ã›ã‚‹</span>
<span class="c1"># ä¾‹ãˆã°</span>
<span class="c1">#   CodeUri: hoge/</span>
<span class="c1">#   Handler: huga</span>
<span class="c1"># ã§ã‚ã‚Œã°ã€</span>
<span class="c1">#   CODE_URI=hoge/</span>
<span class="c1">#   HANDLER=huga</span>
<span class="c1"># ã¨ã™ã‚‹</span>

<span class="nv">CODE_URI</span><span class="o">=</span>hoge/
<span class="nv">HANDLER</span><span class="o">=</span>huga
<span class="nv">GOOS</span><span class="o">=</span>linux <span class="nv">GOARCH</span><span class="o">=</span>amd64 go build -o <span class="si">${</span><span class="nv">CODE_URI</span><span class="si">}</span><span class="si">${</span><span class="nv">HANDLER</span><span class="si">}</span> <span class="si">${</span><span class="nv">CODE_URI</span><span class="si">}</span>main.go

<span class="nv">TEMPLATE</span><span class="o">=</span>./template.yaml
<span class="nv">OUTPUT_TEMPLATE</span><span class="o">=</span>./serverless-output.yaml  <span class="c1"># ãƒ‡ãƒ—ãƒ­ã‚¤ç”¨ã®ä¸­é–“ç”Ÿæˆç‰©ãªã®ã§gitignoreã—ã¦ãŠãã®ãŒè‰¯ã„ã§ã™</span>
<span class="nv">S3_BUCKET</span><span class="o">=</span>YOUR_BUCKET
<span class="nv">S3_PREFIX</span><span class="o">=</span>YOUR_PREFIX
<span class="nv">STACK</span><span class="o">=</span>YOUR_STACK

sam package --template-file <span class="si">${</span><span class="nv">TEMPLATE</span><span class="si">}</span> <span class="se">\
</span><span class="se"></span>  --output-template-file <span class="si">${</span><span class="nv">OUTPUT_TEMPLATE</span><span class="si">}</span> <span class="se">\
</span><span class="se"></span>  --s3-bucket <span class="si">${</span><span class="nv">S3_BUCKET</span><span class="si">}</span> <span class="se">\
</span><span class="se"></span>  --s3-prefix <span class="si">${</span><span class="nv">S3_PREFIX</span><span class="si">}</span>

sam deploy --template-file <span class="si">${</span><span class="nv">OUTPUT_TEMPLATE</span><span class="si">}</span> <span class="se">\
</span><span class="se"></span>  --stack-name <span class="si">${</span><span class="nv">STACK</span><span class="si">}</span> <span class="se">\
</span><span class="se"></span>  --capabilities CAPABILITY_IAM
</code></pre></div><p>ã“ã‚Œã§ã€ä»Šå¾Œmasterãƒ–ãƒ©ãƒ³ãƒã¸ã®pushã‚’ãƒˆãƒªã‚¬ãƒ¼ã«<code>go build</code> =&gt; <code>sam package</code> =&gt; <code>sam deploy</code> ã«ã‚ˆã‚‹ãƒ‡ãƒ—ãƒ­ã‚¤ãŒè‡ªå‹•ã§è¡Œã‚ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</p>
<p>ä»Šå›ã®ä¾‹ã®ã‚ˆã†ã«<code>sam package</code> =&gt; <code>sam deploy</code> ã‚’ã‚·ãƒ³ãƒ—ãƒ«ã«å®Ÿè¡Œã™ã‚‹ã ã‘ã®ãƒ•ãƒ­ãƒ¼ã§ã‚ã‚Œã°ï¼ˆä¸”ã¤CodePipelineå°å…¥ã«ã‚ˆã‚‹ãƒ¡ãƒªãƒƒãƒˆã‚’äº«å—ã—ãŸã„å¼·ã„ç†ç”±ãŒç„¡ã‘ã‚Œã°ï¼‰ã€Travis CIã§ã‚‚ååˆ†ã§ã—ãŸã€ã¨ã„ã†æ‰€æ„Ÿã§ã™ã€‚</p>
<h1 id="heading-2">ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯</h1>
<ul>
<li><a href="https://dev.to/codevbus/deploy-aws-lambda-functions-with-aws-sam-cli-and-travis-ci-3m9m">Deploy AWS Lambda functions with aws-sam-cli and Travis-CI - DEV Community ğŸ‘©â€ğŸ’»ğŸ‘¨â€ğŸ’»</a></li>
<li><a href="https://dev.to/codevbus/deploy-aws-lambda-functions-with-aws-sam-cli-and-travis-ci-part-2-2goh">Deploy AWS Lambda functions with aws-sam-cli and Travis-CI: Part 2 - DEV Community ğŸ‘©â€ğŸ’»ğŸ‘¨â€ğŸ’»</a></li>
<li><a href="https://docs.aws.amazon.com/ja_jp/lambda/latest/dg/build-pipeline.html">AWS CodePipeline ã‚’ä½¿ç”¨ã—ã¦ Lambda ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ç¶™ç¶šçš„ãªé…ä¿¡ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’æ§‹ç¯‰ã™ã‚‹ - AWS Lambda</a></li>
<li><a href="https://github.com/aws-samples/cookiecutter-aws-sam-pipeline">aws-samples/cookiecutter-aws-sam-pipeline: Cookiecutter is an Open Source BSD-3 licensed that provides a template engine to scaffold projects. This project is a a cookiecutter template to create a generic CI/CD pipeline for Serverless App based on Serverless Application Model (SAM).</a></li>
<li><a href="https://github.com/Giftbit/sam-scaffold">Giftbit/sam-scaffold: A template for an AWS SAM project with continuous integration.</a>
<ul>
<li>AWS SAMã§ç®¡ç†ã—ã¦ã„ã‚‹Lambdaãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå‘ã‘ã®CIé››å½¢é›†</li>
</ul>
</li>
</ul>

  </div>
</section>
<section id="tag-pane" class="row meta">
  
  <div class="col-md-12">
    <h6 class="text-right meta">
      
      
      
      
    </h6>
  </div>
  
</section>








<section id="menu-pane" class="row menu text-center">
  
  
  <span><a class="menu-item" href="https://horizoon.jp/post/2019/04/18/contributing_with_gomodules/">&lt; prev | </a></span>
  
  
  <span><a class="menu-item" href="/post">post</a></span>
  
  
  <span><a class="menu-item" href="https://horizoon.jp/post/2019/08/16/aws_sdk_go_assumerole/"> | next &gt;</a></span>
  
  
  <h4 class="text-center"><a class="menu-item" href="https://horizoon.jp">home</a></h4>
</section>



<footer class="row text-center footer">
  <hr />
  
  <h6 class="text-center copyright">Â© 2019. horizoon. <a href="http://creativecommons.org/licenses/by/3.0/">Some Rights Reserved</a>.</h6>
  
  <h6 class="text-center powered">Powered by <a href="https://gohugo.io/">Hugo  v0.62.0</a> &amp; <a href="https://github.com/shenoybr/hugo-goa">Goa</a>.</h6>
  
      
      <h6><a href="" aria-label="RSS Feed"><i class="fas fa-rss" aria-hidden="true"></i></a></h6>
    
  
</footer>

</div>






<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-129776715-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="js/main.js"></script>
<script src="js/custom.js"></script>
</body>
</html>


