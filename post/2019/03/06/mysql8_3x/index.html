<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Language" content="en">

    <meta name="author" content="Fuminori Sakamoto">
    <meta name="description" content="Summary  ver 5.7.12 で追加された「3つのX」。ver 8.0からGA  X Protocol X DevAPI X Plugin   X Protocol  アプリケーションがX Pluginと通信するために使われる新プロトコル。MySQLへの（これまで通りの）SQLインターフェース ＋ NoSQLインタフェースの両方をサポートしている   X DevAPI  MySQL用のNoSQLソリューションを開発したり、Document StoreとしてMySQLを使用したりすることを可能にするAPI Connectors  X DevAPIをサポートしている、言語別クライアント C&#43;&#43;, Java, Node.js, .NET, Python の各言語向けライブラリが公式に提供されている   MySQL Shell  MySQLサーバへの新しい対話型インタフェースで、Connector同様にX DevAPIをサポートしている 以前からのmysqlコマンドと同じSQLインタフェースに加えて、JavaScript, Pythonでもコンソール上での各種操作が可能。 JSやPythonでmysqlコンソールを操作できる     X Plugin  X Protocolをサーバー側で有効にして、X Protocolを使ってクライアントとの通信を可能にする為のプラグイン Document StoreとしてMySQLを使用する為にはX Pluginが有効化されていなければならない  ver 8.0.11以降はデフォルトで有効化されている     Document Store  「3つのX」を使って、JSON DocumentをNoSQL/DocumentDB likeに取り扱う仕組み     X Protocol 公式 - MySQL :: MySQL Internals Manual :: 15 X Protocol">
    <meta name="keywords" content="blog,developer,backpacker,personal">

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="MySQL8.0 Document Store関連技術まとめ"/>
<meta name="twitter:description" content="Summary  ver 5.7.12 で追加された「3つのX」。ver 8.0からGA  X Protocol X DevAPI X Plugin   X Protocol  アプリケーションがX Pluginと通信するために使われる新プロトコル。MySQLへの（これまで通りの）SQLインターフェース ＋ NoSQLインタフェースの両方をサポートしている   X DevAPI  MySQL用のNoSQLソリューションを開発したり、Document StoreとしてMySQLを使用したりすることを可能にするAPI Connectors  X DevAPIをサポートしている、言語別クライアント C&#43;&#43;, Java, Node.js, .NET, Python の各言語向けライブラリが公式に提供されている   MySQL Shell  MySQLサーバへの新しい対話型インタフェースで、Connector同様にX DevAPIをサポートしている 以前からのmysqlコマンドと同じSQLインタフェースに加えて、JavaScript, Pythonでもコンソール上での各種操作が可能。 JSやPythonでmysqlコンソールを操作できる     X Plugin  X Protocolをサーバー側で有効にして、X Protocolを使ってクライアントとの通信を可能にする為のプラグイン Document StoreとしてMySQLを使用する為にはX Pluginが有効化されていなければならない  ver 8.0.11以降はデフォルトで有効化されている     Document Store  「3つのX」を使って、JSON DocumentをNoSQL/DocumentDB likeに取り扱う仕組み     X Protocol 公式 - MySQL :: MySQL Internals Manual :: 15 X Protocol"/>

    <meta property="og:title" content="MySQL8.0 Document Store関連技術まとめ" />
<meta property="og:description" content="Summary  ver 5.7.12 で追加された「3つのX」。ver 8.0からGA  X Protocol X DevAPI X Plugin   X Protocol  アプリケーションがX Pluginと通信するために使われる新プロトコル。MySQLへの（これまで通りの）SQLインターフェース ＋ NoSQLインタフェースの両方をサポートしている   X DevAPI  MySQL用のNoSQLソリューションを開発したり、Document StoreとしてMySQLを使用したりすることを可能にするAPI Connectors  X DevAPIをサポートしている、言語別クライアント C&#43;&#43;, Java, Node.js, .NET, Python の各言語向けライブラリが公式に提供されている   MySQL Shell  MySQLサーバへの新しい対話型インタフェースで、Connector同様にX DevAPIをサポートしている 以前からのmysqlコマンドと同じSQLインタフェースに加えて、JavaScript, Pythonでもコンソール上での各種操作が可能。 JSやPythonでmysqlコンソールを操作できる     X Plugin  X Protocolをサーバー側で有効にして、X Protocolを使ってクライアントとの通信を可能にする為のプラグイン Document StoreとしてMySQLを使用する為にはX Pluginが有効化されていなければならない  ver 8.0.11以降はデフォルトで有効化されている     Document Store  「3つのX」を使って、JSON DocumentをNoSQL/DocumentDB likeに取り扱う仕組み     X Protocol 公式 - MySQL :: MySQL Internals Manual :: 15 X Protocol" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://horizoon.jp/post/2019/03/06/mysql8_3x/" />
<meta property="article:published_time" content="2019-03-06T12:15:00+09:00" />
<meta property="article:modified_time" content="2019-03-06T12:15:00+09:00" />


    <title>
  MySQL8.0 Document Store関連技術まとめ · horizoon
</title>

    
      <link rel="canonical" href="https://horizoon.jp/post/2019/03/06/mysql8_3x/">
    

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.1.7/css/fork-awesome.min.css"
      integrity="sha256-gsmEoJAws/Kd3CjuOQzLie5Q3yshhvmo7YNtBG7aaEY=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8/normalize.min.css">
    
      
      
      <link rel="stylesheet" href="https://horizoon.jp/css/coder.min.f01c647a0d25b40da992a37c3376291185eed8a50ced8c26cc2c0bcfe38c97df.css" integrity="sha256-8Bxkeg0ltA2pkqN8M3YpEYXu2KUM7YwmzCwLz&#43;OMl98=" crossorigin="anonymous" media="screen" />
    

    

    
      
        
        
        <link rel="stylesheet" href="https://horizoon.jp/css/coder-dark.min.126ad3988d46bdae6217a11105b53c9662bca05f39d42d3c0fb366919d334620.css" integrity="sha256-EmrTmI1Gva5iF6ERBbU8lmK8oF851C08D7NmkZ0zRiA=" crossorigin="anonymous" media="screen" />
      
    

    

    

    <link rel="icon" type="image/png" href="https://horizoon.jp/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://horizoon.jp/favicon-16x16.png" sizes="16x16">

    <link rel="apple-touch-icon" href="https://horizoon.jp/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://horizoon.jp/images/apple-touch-icon.png">

    

    <meta name="generator" content="Hugo 0.80.0" />
  </head>

  
  
    
  
  <body class="colorscheme-auto"
        onload=""
  >
    
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://horizoon.jp/">
      horizoon
    </a>
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link" href="https://horizoon.jp/post/">Blog</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="https://horizoon.jp/projects/">Projects</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="https://horizoon.jp/about/">About</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


      <div class="content">
        
  <section class="container page">
  <article>
    <header>
      <h1>MySQL8.0 Document Store関連技術まとめ</h1>
    </header>

    <h2 id="summary">Summary</h2>
<ul>
<li>ver 5.7.12 で追加された「3つのX」。ver 8.0からGA
<ul>
<li>X Protocol</li>
<li>X DevAPI</li>
<li>X Plugin</li>
</ul>
</li>
<li><a href="https://dev.mysql.com/doc/internals/en/x-protocol.html">X Protocol</a>
<ul>
<li>アプリケーションがX Pluginと通信するために使われる新プロトコル。MySQLへの（これまで通りの）SQLインターフェース ＋ NoSQLインタフェースの両方をサポートしている</li>
</ul>
</li>
<li><a href="https://dev.mysql.com/doc/x-devapi-userguide/en/">X DevAPI</a>
<ul>
<li>MySQL用のNoSQLソリューションを開発したり、Document StoreとしてMySQLを使用したりすることを可能にするAPI</li>
<li><a href="https://dev.mysql.com/downloads/connector/">Connectors</a>
<ul>
<li>X DevAPIをサポートしている、言語別クライアント</li>
<li>C++, Java, Node.js, .NET, Python の各言語向けライブラリが公式に提供されている</li>
</ul>
</li>
<li><a href="https://dev.mysql.com/doc/mysql-shell/8.0/en/">MySQL Shell</a>
<ul>
<li>MySQLサーバへの新しい対話型インタフェースで、Connector同様にX DevAPIをサポートしている</li>
<li>以前からのmysqlコマンドと同じSQLインタフェースに加えて、JavaScript, Pythonでもコンソール上での各種操作が可能。 <strong>JSやPythonでmysqlコンソールを操作できる</strong></li>
</ul>
</li>
</ul>
</li>
<li><a href="https://dev.mysql.com/doc/refman/8.0/en/x-plugin.html">X Plugin</a>
<ul>
<li>X Protocolをサーバー側で有効にして、X Protocolを使ってクライアントとの通信を可能にする為のプラグイン</li>
<li>Document StoreとしてMySQLを使用する為にはX Pluginが有効化されていなければならない
<ul>
<li>ver 8.0.11以降はデフォルトで有効化されている</li>
</ul>
</li>
</ul>
</li>
<li>Document Store
<ul>
<li><strong>「3つのX」を使って、JSON DocumentをNoSQL/DocumentDB likeに取り扱う仕組み</strong></li>
</ul>
</li>
</ul>
<figure class="center">
    <img src="https://horizoon.jp/img/mysql8_doc/1.png"/> 
</figure>

<h2 id="x-protocol">X Protocol</h2>
<p><a href="https://dev.mysql.com/doc/internals/en/x-protocol.html">公式 - MySQL :: MySQL Internals Manual :: 15 X Protocol</a></p>
<ul>
<li>X Protocolは、X DevAPIを使用してサーバーと通信するように設計されている</li>
<li>X Protocolは、通常のSQLインターフェースもサポートしている。つまり先述のDocument Storeの機能と合わせてSQL/NoSQL両方のインタフェースを使用するアプリケーションを構築できる</li>
</ul>
<p><a href="https://dev.mysql.com/worklog/task/?id=8639">worklogで言及されている</a> 通り、X Protocolは拡張性・パフォーマンス・セキュリティ、の3点に主眼を置いて設計された新しいClient/Serverプロトコルです。過去のバージョンのC/Sプロトコルはこれらに課題を抱えていたという事ですが、下位互換性を維持しながら機能修正を行っていく事が厳しいという事情がありました。そうした経緯で全く新しいプロトコルが新たに開発されました。</p>
<p>X Protocolの特徴として、まずセキュリティに関してはTLS, <a href="https://dev.mysql.com/doc/internals/en/x-protocol-authentication-authentication.html">SASL</a>といった信頼性が証明されている標準技術が<a href="https://dev.mysql.com/doc/internals/en/x-protocol-lifecycle-lifecycle.html">採用されています</a>。またパフォーマンスに関しては<a href="https://dev.mysql.com/doc/internals/en/x-protocol-implementation-implementation-notes.html">Client/Server間のやり取りのパイプライン化や、サーバー側でのマルチスレッド化といった対応</a> で改善されています。</p>
<p>過去のC/Sプロトコルとの比較は<a href="https://dev.mysql.com/doc/internals/en/x-protocol-comparison-comparison-to-mysql-c-s-protocol.html">こちら</a> が詳しいですが、セキュリティ対策やパフォーマンス改善も含めて、機能追加・修正が行いやすい事に貢献している大きな材料が<a href="https://dev.mysql.com/doc/internals/en/x-protocol-messages-messages.html">C/S間のメッセージのやり取りにProtocol Buffersを採用している</a> 事ではないかと思います。言語・プラットフォームに依存せず・厳密な型定義を保ちながら・拡張可能なメカニズムでデータをserialize可能である、という特徴がX Protocolで実現したかった要件とマッチしていて、現状ベストな選択と言えそうです。</p>
<p>X Protocolのprotobuf定義は<a href="https://github.com/mysql/mysql-server/tree/8.0/plugin/x/protocol">githubで公開されています</a>。</p>
<h2 id="x-devapi">X DevAPI</h2>
<p><a href="https://dev.mysql.com/doc/x-devapi-userguide/en/">公式 - MySQL :: X DevAPI User Guide</a></p>
<ul>
<li>X DevAPIは、JSON Documentおよび（従来からの）リレーショナルデータと簡単にやり取りできるように設計されている。両方をサポートしているAPIである、という事が特徴
<ul>
<li>前者がDocument Store機能。NoSQLインタフェースを実装するクラスとメソッドのライブラリが提供されている</li>
</ul>
</li>
</ul>
<p>X DevAPIはX Protocolを実装しているクライアントからのみ利用可能です。X DevAPIをサポートしているクライアントは下記の通りです。</p>
<ul>
<li><a href="https://dev.mysql.com/downloads/shell/">MySQL Shell</a>  （後述）</li>
<li><a href="https://dev.mysql.com/downloads/connector/j/">Connector/J</a>　※Java</li>
<li><a href="https://dev.mysql.com/downloads/connector/nodejs/">Connector/Node.js</a></li>
<li><a href="https://dev.mysql.com/downloads/connector/python/">Connector/Python</a></li>
<li><a href="https://dev.mysql.com/downloads/connector/net/">Connector/NET</a>　※.NET</li>
<li><a href="https://dev.mysql.com/downloads/connector/cpp/">Connector/C++</a></li>
</ul>
<p>X DevAPIでは <a href="https://dev.mysql.com/doc/x-devapi-userguide/en/connecting-to-a-single-mysqld-node-setup.html">mysqlx というモジュールを使って Session と呼ばれるX Protocol接続オブジェクトを取得し</a>、mysqlサーバに接続します。これにより、JSONデータをDocument Storeとして取り扱うクラスやメソッド群が使用可能になります。逆にX Pluginが有効ではない（古い）プロトコルでの接続は Classic Session と呼ばれるオブジェクトで管理されます。各言語のConnectorでは、共通して<code>mysqlx</code>と呼ばれるモジュールにより、従来の機能（API）とは独立した形でX DevAPIの機能が提供されています。</p>
<p>接続を司るSessionオブジェクトも含め、X DevAPIを実装している各クライアント（のmysqlxモジュール）は下記構成で機能が提供されています。</p>
<figure class="center">
    <img src="https://horizoon.jp/img/mysql8_doc/2.png"/> <figcaption>
            <h4>（mysqlxモジュールの構成図）</h4>
        </figcaption>
</figure>

<p>現状では先程のリストに挙がっていない言語、例えばRubyやGoでは公式にConnectorは提供されていませんが、各言語のconnector APIリファレンス（例：<a href="https://dev.mysql.com/doc/dev/connector-nodejs/8.0/">Node.jsのもの</a>）や、拡張BNF（<a href="https://dev.mysql.com/doc/x-devapi-userguide/en/mysql-x-crud-ebnf-definitions.html">CRUD関連</a> 、 <a href="https://dev.mysql.com/doc/x-devapi-userguide/en/mysql-x-expressions-ebnf-definitions.html">式関連</a> ）が公開されており、これらを参考に独自実装する事も不可能では無さそうです。</p>
<figure class="center">
    <img src="https://horizoon.jp/img/mysql8_doc/3.png"/> <figcaption>
            <h4>（Databaseオブジェクトのクラス図）</h4>
        </figcaption>
</figure>

<figure class="center">
    <img src="https://horizoon.jp/img/mysql8_doc/4.png"/> <figcaption>
            <h4>（Resultオブジェクトのクラス図）</h4>
        </figcaption>
</figure>

<h3 id="mysql-shell">MySQL Shell</h3>
<p><a href="https://dev.mysql.com/doc/mysql-shell/8.0/en/">公式 - MySQL :: MySQL Shell 8.0</a></p>
<p><a href="https://dev.mysql.com/doc/dev/mysqlsh-api-javascript/8.0/">公式 - MySQL Shell: Main Page(JavaScript)</a></p>
<ul>
<li>MySQL Shellでは、過去のmysqlクライアントと同じ操作が可能な <strong>SQLモード</strong> が提供されている
<ul>
<li>従来の <code>mysql</code> コマンドで立ち上げたmysqlコンソールと全く同じ操作が、MySQL Shellでも可能</li>
</ul>
</li>
<li>加えて、JavaScript, Pythonの2言語が対話型インタフェースとして追加された
<ul>
<li>両言語では、対話型だけでなくバッチモードで・各言語でのスクリプト処理も開発・実行できる</li>
</ul>
</li>
<li>MySQL Shellを立ち上げてからでも、言語の切り替えが出来る
<ul>
<li>例えば <code>\js</code> と打てばJavaScriptモードになる</li>
</ul>
</li>
</ul>
<p>MySQL Shellは「X Pluginを介してサーバーと通信する為にX Protocolを使用するように設計されているクライアント」で、つまりリレーショナル（SQL）、Document Store（NoSQL） いずれの方式にも対応しているクライアントです。</p>
<p>Macなどでサクッとver8のMySQLを立ち上げて試したければ、<a href="https://hub.docker.com/_/mysql?tab=tags">8系のDockerfileが公開されているので</a>これを使うのが良いでしょう。</p>
<div class="highlight"><div style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#60a0b0;font-style:italic"># docker-compose.yml</span><span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">version</span>:<span style="color:#bbb"> </span><span style="color:#4070a0">&#39;3&#39;</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">services</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#062873;font-weight:bold">mysql</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#062873;font-weight:bold">image</span>:<span style="color:#bbb"> </span>mysql:8.0<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#062873;font-weight:bold">environment</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>- MYSQL_ROOT_PASSWORD=root<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#062873;font-weight:bold">volumes</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>- ./.data/mysql:/var/lib/mysql<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#062873;font-weight:bold">ports</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>- <span style="color:#4070a0">&#34;3306:3306&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span>- <span style="color:#4070a0">&#34;33060:33060&#34;</span><span style="color:#bbb">
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ docker-compose up
</code></pre></td></tr></table>
</div>
</div><p>Mac向けのMySQL Shellは<a href="https://dev.mysql.com/downloads/shell/">dmgで公開されている</a>のでこれをインストールし、SQLモードでshellを立ち上げてみるとプロンプトがシャレオツなmysqlコンソールが立ち上がります。ポート番号は後述のX Pluginが接続を待ち受ける番号を指定します（デフォルトが33060）</p>
<p><code>--sql</code> とSQLモードで立ち上げたMySQL Shellは、過去バージョンのmysqlコマンドで利用可能な機能が全てそのまま使えます。</p>
<div class="highlight"><div style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ mysqlsh -u root -proot -h localhost -P33060 --sql
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">:

Creating a <span style="color:#007020;font-weight:bold">session</span> <span style="color:#007020;font-weight:bold">to</span> <span style="color:#4070a0">&#39;root@localhost:33060&#39;</span>
Fetching <span style="color:#007020;font-weight:bold">schema</span> <span style="color:#007020;font-weight:bold">names</span> <span style="color:#007020;font-weight:bold">for</span> autocompletion... Press <span style="color:#666">^</span><span style="color:#007020;font-weight:bold">C</span> <span style="color:#007020;font-weight:bold">to</span> stop.
Your MySQL <span style="color:#007020;font-weight:bold">connection</span> id <span style="color:#007020;font-weight:bold">is</span> <span style="color:#40a070">1</span> (X protocol)

:
:

MySQL  localhost:<span style="color:#40a070">33060</span><span style="color:#666">+</span> ssl  <span style="color:#007020;font-weight:bold">SQL</span> <span style="color:#666">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p><code>\js</code>と入力するとJavaScriptモードに、<code>\py</code>と入力するとPythonモードに切り替わります</p>
<div class="highlight"><div style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">MySQL  localhost:<span style="color:#40a070">33060</span><span style="color:#666">+</span> ssl  <span style="color:#007020;font-weight:bold">SQL</span> <span style="color:#666">&gt;</span> <span style="">\</span>js
Switching <span style="color:#007020;font-weight:bold">to</span> JavaScript <span style="color:#007020;font-weight:bold">mode</span>...

MySQL  localhost:<span style="color:#40a070">33060</span><span style="color:#666">+</span> ssl  JS <span style="color:#666">&gt;</span> <span style="">\</span>py
Switching <span style="color:#007020;font-weight:bold">to</span> Python <span style="color:#007020;font-weight:bold">mode</span>...

MySQL  localhost:<span style="color:#40a070">33060</span><span style="color:#666">+</span> ssl  Py <span style="color:#666">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>mysqlshコマンドで、従来のmysqlコマンド（C/Sプロトコル）による接続を行う事も可能です。その場合portにはサーバが使用している待受ポートを指定し、合わせて<code>--classic</code>というオプションを指定します。X Protocolで接続した場合と異なり、</p>
<ul>
<li><code>Creating a Classic session...</code> というメッセージが表示される</li>
<li>接続後のプロンプトのポート番号部分に<code>+</code>表記が無い</li>
</ul>
<p>という違いがあります。</p>
<div class="highlight"><div style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ mysqlsh -u root -proot -h localhost -P3306 --sql --classic
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">:

Creating a Classic <span style="color:#007020;font-weight:bold">session</span> <span style="color:#007020;font-weight:bold">to</span> <span style="color:#4070a0">&#39;root@localhost:3306&#39;</span>
Fetching <span style="color:#007020;font-weight:bold">schema</span> <span style="color:#007020;font-weight:bold">names</span> <span style="color:#007020;font-weight:bold">for</span> autocompletion... Press <span style="color:#666">^</span><span style="color:#007020;font-weight:bold">C</span> <span style="color:#007020;font-weight:bold">to</span> stop.
Your MySQL <span style="color:#007020;font-weight:bold">connection</span> id <span style="color:#007020;font-weight:bold">is</span> <span style="color:#40a070">2</span>

:
:

MySQL  localhost:<span style="color:#40a070">3306</span> ssl  <span style="color:#007020;font-weight:bold">SQL</span> <span style="color:#666">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="x-plugin">X Plugin</h2>
<p><a href="https://dev.mysql.com/doc/refman/8.0/en/x-plugin.html">公式 - MySQL :: MySQL 8.0 Reference Manual :: 20.5 X Plugin</a></p>
<ul>
<li>X Pluginは、実行タイミングで有効化・無効化が可能
<ul>
<li>ver 8.0からは、デフォルトで有効化されている</li>
</ul>
</li>
<li>X Pluginがロードされると、X Protocolを使用した通信も有効化される
<ul>
<li>つまりX Pluginがロードされて初めてDocument Storeの機能も有効になる</li>
</ul>
</li>
<li>X Pluginは、MySQLサーバのポート（=3306）とは別のポートで接続を待ち受ける
<ul>
<li>デフォルト = 33060</li>
</ul>
</li>
<li>関連するサーバ設定は <code>mysqlx_xxx</code> という名前になっている</li>
</ul>
<p>X Protocolをサーバー側で有効にして、X Protocolを使ってクライアントとの通信を可能にする為のプラグインがX Pluginです。MySQLをDocument Storeとして活用するにはX Protocolでの通信が必須であり、つまりDocument Storeとして活用する為の前提条件はX Pluginを有効にする事と言えます。</p>
<p>X Pluginの特徴の1つとして、クライアント/サーバ間の通信で使っているSSL証明書と別のSSL証明書を使って（プラグインへの）接続を行う事が可能という点が挙げられます。下記がmy.cnfの設定例ですが、<code>mysqld</code> セクションのSSL関連の設定パラメータに <code>mysqlx_</code> というprefixを付けたパラメータで、サーバで使っているSSL証明書と別の証明書を指定する事ができます。</p>
<div class="highlight"><div style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">[mysqld]
ssl-ca = /path/to/ca_server.pem
ssl-cert = /path/to/server-cert.pem
ssl-key = /path/to/server-key.pem

mysqlx-ssl-ca = /path/to/ca_xplugin.pem
mysqlx-ssl-cert = /path/to/xplugin-cert.pem
mysqlx-ssl-key = /path/to/xplugin-key.pem
</code></pre></td></tr></table>
</div>
</div><p>X PluginはMySQLサーバとは別のポート＝デフォルトで33060番ポートを使って通信を行います。先述のMySQL Shellを使ってX Pluginと対話型インタフェースで接続するには下記コマンドで接続します。</p>
<div class="highlight"><div style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#60a0b0;font-style:italic"># ポート番号として33060を指定</span>
$ mysqlsh -u root -proot -h localhost -P33060 --sql
</code></pre></td></tr></table>
</div>
</div><p>ver 8.0からX Pluginがデフォルトで有効化されている事は、下記の通り<code>show plugin</code>文を実行すると確認する事ができます。例えばこの記事執筆時点で公開されてるver8系の公式Docker imageは8.0.15が使われていますが、このimageを使っても確認可能です。</p>
<div class="highlight"><div style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#666">&gt;</span> <span style="color:#007020;font-weight:bold">show</span> plugins;

<span style="color:#666">+</span><span style="color:#60a0b0;font-style:italic">---------------------------------+----------+--------------------+---------+---------+
</span><span style="color:#60a0b0;font-style:italic"></span><span style="color:#666">|</span> Name                            <span style="color:#666">|</span> Status   <span style="color:#666">|</span> <span style="color:#007020;font-weight:bold">Type</span>               <span style="color:#666">|</span> Library <span style="color:#666">|</span> License <span style="color:#666">|</span>
<span style="color:#666">+</span><span style="color:#60a0b0;font-style:italic">---------------------------------+----------+--------------------+---------+---------+
</span><span style="color:#60a0b0;font-style:italic"></span><span style="color:#666">|</span> mysqlx                          <span style="color:#666">|</span> ACTIVE   <span style="color:#666">|</span> DAEMON             <span style="color:#666">|</span> <span style="color:#007020;font-weight:bold">NULL</span>    <span style="color:#666">|</span> GPL     <span style="color:#666">|</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="ブックマーク">ブックマーク</h2>
<ul>
<li><a href="https://insidemysql.com/tag/x-devapi/">x-devapi | InsideMySQL.com</a></li>
<li><a href="https://mysqlserverteam.com/import-json-to-mysql-made-easy-with-the-mysql-shell/">Import JSON to MySQL made easy with the MySQL Shell | MySQL Server Blog</a></li>
<li>X ProtocolのGo実装？と思しきリポジトリ
<ul>
<li><a href="https://github.com/AlekSi/mysqlx">AlekSi/mysqlx: MySQL driver for Go&rsquo;s (golang) database/sql package and MySQL X Protocol</a>
<ul>
<li>直近の更新頻度はこのプロジェクトが一番活発</li>
</ul>
</li>
<li><a href="https://github.com/sjmudd/go-mysqlx-driver">sjmudd/go-mysqlx-driver: A MySQL X protocol driver for Go&rsquo;s database/sql package</a>
<ul>
<li>おそらく最古</li>
</ul>
</li>
<li><a href="https://github.com/pingcap/mysqlx-driver">pingcap/mysqlx-driver: A MySQL X protocol driver for Go&rsquo;s database/sql package</a></li>
</ul>
</li>
<li><a href="https://severalnines.com/blog/mysql-performance-benchmarking-mysql-57-vs-mysql-80">MySQL Performance Benchmarking: MySQL 5.7 vs MySQL 8.0 | Severalnines</a></li>
</ul>

  </article>
</section>

  

      </div>

      
  <footer class="footer">
    <section class="container">
      
      
        ©
        
          2017 -
        
        2021
         Fuminori Sakamoto 
      
      
         · 
        Powered by <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/">Coder</a>.
      
      
    </section>
  </footer>


    </main>

    
      
        
        <script src="https://horizoon.jp/js/dark-mode.min.0213e1773e6d1c5a644f847c67a6f8abac49a3776e2976f6008038af8c5b76a1.js"></script>
      
    

    

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-129776715-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


    

    

    

    
  </body>

</html>
